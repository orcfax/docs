"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3728],{5506:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"incentivized-testnet/phase 1 manual","title":"Phase 1 manual","description":"More info to be provided as we approach this ITN phase.","source":"@site/docs/incentivized-testnet/phase-1-manual.md","sourceDirName":"incentivized-testnet","slug":"/phase-1-manual","permalink":"/phase-1-manual","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"phase 1 manual","sidebar_position":2,"slug":"/phase-1-manual"},"sidebar":"tutorialSidebar","previous":{"title":"ITN overview","permalink":"/itn-overview"},"next":{"title":"Phase 2 manual","permalink":"/phase-2-manual"}}');var s=i(4848),t=i(8453);const a={id:"phase 1 manual",sidebar_position:2,slug:"/phase-1-manual"},r="Phase 1 manual",l={},c=[{value:"Data collection for CEXes",id:"data-collection-for-cexes",level:2},{value:"Hardware and infrastructure",id:"hardware-and-infrastructure",level:3},{value:"Logging issues",id:"logging-issues",level:3},{value:"Aliasing your signing key",id:"aliasing-your-signing-key",level:3},{value:"Software and setup",id:"software-and-setup",level:3},{value:"Collector node",id:"collector-node",level:4},{value:"Installing in a virtual environment",id:"installing-in-a-virtual-environment",level:4},{value:"CEX collector (gofer)",id:"cex-collector-gofer",level:4},{value:"node-identity.json",id:"node-identityjson",level:5},{value:"cer-feeds.json",id:"cer-feedsjson",level:4},{value:"Signing key",id:"signing-key",level:3},{value:"Directory layout",id:"directory-layout",level:3},{value:"Environment variables",id:"environment-variables",level:3},{value:"Configuring unused variables",id:"configuring-unused-variables",level:4},{value:"Cron",id:"cron",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"phase-1-manual",children:"Phase 1 manual"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"More info to be provided as we approach this ITN phase."})}),"\n",(0,s.jsx)(n.h2,{id:"data-collection-for-cexes",children:"Data collection for CEXes"}),"\n",(0,s.jsx)(n.p,{children:"During this phase, validators will begin decentralizing the collection function\nof the Orcfax Network."}),"\n",(0,s.jsx)(n.p,{children:"Validators will initially run a limited suite of software responsible for the\ncollection of data from centralized exchanges which have been identified as\nprimary sources of information."}),"\n",(0,s.jsx)(n.p,{children:"Validators will then participate in funneling that data to the Orcfax federated\nvalidator and publisher."}),"\n",(0,s.jsx)(n.h3,{id:"hardware-and-infrastructure",children:"Hardware and infrastructure"}),"\n",(0,s.jsx)(n.p,{children:"During this phase of the ITN, the hardware requirements will be minimal to\nhandle the tasks involved. Participants should expect to meet the following\nminimum requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2GB of RAM"}),"\n",(0,s.jsx)(n.li,{children:"A single CPU"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"logging-issues",children:"Logging issues"}),"\n",(0,s.jsxs)(n.p,{children:["ITN Phase 1 will use a ",(0,s.jsx)(n.a,{href:"https://github.com/orcfax/ITN-Phase-1/",children:"GitHub repository"})," to record issues. You can\nuse this with a GitHub account if you have one."]}),"\n",(0,s.jsx)(n.p,{children:"You can also send issues to Orcfax via the support channels in Discord; Orcfax\nwill then transpose them to the GitHub Issues for the benefit of the Orcfax\ncommunity."}),"\n",(0,s.jsxs)(n.p,{children:["The issues can be found ",(0,s.jsx)(n.a,{href:"https://github.com/orcfax/ITN-Phase-1/issues",children:"here"}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"N.B.",type:"info",children:(0,s.jsx)(n.p,{children:"The measurable participation of operators, including via GitHub, is one way in\nwhich the health of the Orcfax network will be made apparent to integrators,\nwhich will be critical to the network's ability to attract and generate revenue."})}),"\n",(0,s.jsx)(n.h3,{id:"aliasing-your-signing-key",children:"Aliasing your signing key"}),"\n",(0,s.jsxs)(n.p,{children:["Before you continue, you will need to alias your signing key by following the\nguide ",(0,s.jsx)(n.a,{href:"signing-key-aliasing",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"software-and-setup",children:"Software and setup"}),"\n",(0,s.jsx)(n.p,{children:"There are three components needed for Phase 1 of the ITN. You will need the\nlatest versions of each."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/orcfax/collector-node/releases",children:"collector-node"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/orcfax/oracle-suite/releases",children:"cex collector (gofer)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://raw.githubusercontent.com/orcfax/cer-feeds/refs/tags/2024.10.30.0001/feeds/mainnet/cer-feeds.json",children:"cer-feeds.json"})}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{title:"KEEPING UP TO DATE",type:"info",children:[(0,s.jsx)(n.p,{children:"There needs to be some flexibility in the versions of software being run on a\ndecentralized network."}),(0,s.jsx)(n.p,{children:"That being said, Orcfax will coordinate with ITN participants to provide them\nthe most up to date information about maintaining their setup and if versions\ncan or need to be upgraded. This page will also be added to as required."})]}),"\n",(0,s.jsx)(n.h4,{id:"collector-node",children:"Collector node"}),"\n",(0,s.jsx)(n.p,{children:"The latest release of the collector node needs to be installed in a Python\nvirtual environment and will be configured to run via cron."}),"\n",(0,s.jsx)(n.h4,{id:"installing-in-a-virtual-environment",children:"Installing in a virtual environment"}),"\n",(0,s.jsxs)(n.p,{children:["Assume we download the Python Wheel (*.whl)\n",(0,s.jsx)(n.code,{children:"collector_node-2.0.0a11-py3-none-any.whl"}),". The software can be installed with:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"python3 -m venv venv\nsource venv/bin/activate\npython -m pip install collector_node-2.0.0a11-py3-none-any.whl\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"STAYING INFORMED",type:"info",children:(0,s.jsx)(n.p,{children:"Take the time to look through the different repositories and their README files\nto fully understand the software you're running as part of the Orcfax Network."})}),"\n",(0,s.jsx)(n.h4,{id:"cex-collector-gofer",children:"CEX collector (gofer)"}),"\n",(0,s.jsxs)(n.p,{children:["Gofer was originally published by ",(0,s.jsx)(n.a,{href:"https://chroniclelabs.org/",children:"Chronicle-Labs"})," and has been\nmodified to publish data according to Orcfax's data standard."]}),"\n",(0,s.jsxs)(n.p,{children:["There are multiple releases available, it is likely you will want the\n",(0,s.jsx)(n.code,{children:"gofer_0.4.0_Linux_x86_64"})," release. When you download this you will need to give\nit executable permissions, i.e. ",(0,s.jsx)(n.code,{children:"chmod +x /path/to/gofer"}),"."]}),"\n",(0,s.jsx)(n.h5,{id:"node-identityjson",children:"node-identity.json"}),"\n",(0,s.jsx)(n.p,{children:"A node-identity file will need to be created. The quickest way to do this is to\nrun gofer standalone:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"./gofer data ADA/USD -o orcfax\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsxs)(n.p,{children:["You can prettify this data using tools such as ",(0,s.jsx)(n.a,{href:"https://jqlang.github.io/jq/",children:"jq"}),", e.g. with the\ncommand:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"./gofer data ADA/USD -o orcfax | jq\n"})})]}),"\n",(0,s.jsxs)(n.p,{children:["The identity file will be output to ",(0,s.jsx)(n.code,{children:"/tmp/.node-identity.json"})," and will be\nreferenced in the cron job described below."]}),"\n",(0,s.jsx)(n.h4,{id:"cer-feedsjson",children:"cer-feeds.json"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"cer-feeds.json"})," is used by Orcfax to coordinate publication. It contains a list\nof CEX and DEX feeds that we publish. DEX publication will not be triggered in\nPhase 1."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"cer-feeds.json"})," will be provided to the collector as a command line argument.\nIt can be downloaded from ",(0,s.jsx)(n.a,{href:"https://github.com/orcfax/cer-feeds",children:"GitHub"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The latest feeds for the preview network can be downloaded from this\n",(0,s.jsx)(n.a,{href:"https://raw.githubusercontent.com/orcfax/cer-feeds/refs/heads/main/feeds/preview/cer-feeds.json",children:"link"}),", or alternatviely on the command line using a tool like\n",(0,s.jsx)(n.code,{children:"wget"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"wget https://raw.githubusercontent.com/orcfax/cer-feeds/refs/heads/main/feeds/preview/cer-feeds.json\n"})}),"\n",(0,s.jsx)(n.h3,{id:"signing-key",children:"Signing key"}),"\n",(0,s.jsxs)(n.p,{children:["Information has been provided about the ",(0,s.jsx)(n.a,{href:"signing-key-aliasing",children:"signing key and signing key aliasing\nprotocol"})," which you should have already done. For completeness, the\nprocess is as follows:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a new verification (",(0,s.jsx)(n.code,{children:"vkey"}),") and signing (",(0,s.jsx)(n.code,{children:"skey"}),") key pair:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"cardano-cli address key-gen \\\n --verification-key-file payment.vkey \\\n --signing-key-file payment.skey\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Build the new payment address:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"cardano-cli address build \\\n --payment-verification-key-file payment.vkey \\\n --out-file payment.addr \\\n --mainnet\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["Calculate the ",(0,s.jsx)(n.code,{children:"vkey"})," hash:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"cardano-cli address key-hash \\\n  --payment-verification-key-file payment.vkey \\\n  --out-file payment.hash\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You will use a path to your ",(0,s.jsx)(n.code,{children:"payment.skey"})," in the environment variables and the\ncron job described below."]}),"\n",(0,s.jsx)(n.h3,{id:"directory-layout",children:"Directory layout"}),"\n",(0,s.jsx)(n.p,{children:"There are different ways to organize the collector code. Orcfax uses a number of\ndirectories internally, e.g. for the collector, gofer, and signing-key."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\u251c\u2500\u2500 collector\n\u2502\xa0\xa0 \u2514\u2500\u2500 venv\n\u251c\u2500\u2500 gofer/\n    \u2514\u2500\u2500 gofer\n\u251c\u2500\u2500 signing-key\n    \u2514\u2500\u2500 payment.skey\n"})}),"\n",(0,s.jsx)(n.p,{children:"These could all be in one directory, e.g."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:".orcfax\n\u2514\u2500\u2500 collector\n    \u251c\u2500\u2500 gofer\n    \u251c\u2500\u2500 payment.skey\n    \u2514\u2500\u2500 venv\n"})}),"\n",(0,s.jsx)(n.p,{children:"And they will be pointed at in the cron job described below. The contents of the\npayment.hash file will be used to alias the wallet in which you hold the Orcfax\nValidator License."}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment variables"}),"\n",(0,s.jsx)(n.p,{children:"When configuring the Orcfax collector node you will need a set of environment\nvariables, these are:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"# example layout for a .env file.\n\n## variables used in ITN Phase 1.\nexport ORCFAX_VALIDATOR=\nexport NODE_IDENTITY_LOC=\nexport NODE_SIGNING_KEY=\nexport GOFER=\n\n# variables not used in ITN Phase 1 but cannot be null.\nexport CNT_DB_NAME=/var/tmp/notused.db\nexport OGMIOS_URL=ws://example.com/ogmios\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you run the Orcfax collector standalone, e.g. to get a feel for how it works\nyou can set these before hand. You can store them in an environment file, e.g.\n",(0,s.jsx)(n.code,{children:"node.env"})," and on the command line run:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"source node.env\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The variables will only remain in-scope in a given session window. They will\nneed to be set each time you run the collector-node in a different command-line\nwindow. For the cron task (below) we set them within the scope of a cron job."})}),"\n",(0,s.jsx)(n.h4,{id:"configuring-unused-variables",children:"Configuring unused variables"}),"\n",(0,s.jsx)(n.p,{children:"Because ITN Phase 1 collectors do not yet collect CNT prices there are some\nexcess configuration values that need to be set, but remain unused."}),"\n",(0,s.jsx)(n.p,{children:"For ogmios, we can just use a non-existent url, e.g."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"export OGMIOS_URL=ws://example.com\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For the database, we need to point to a path that does exist, but we can do this\nusing ",(0,s.jsx)(n.code,{children:"touch"})," as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"touch /var/tmp/noused.db\n"})}),"\n",(0,s.jsx)(n.p,{children:"We can then set the path as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"export CNT_DB_NAME=/var/tmp/notused.db\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"/var/tmp"})," is a good location to use for this value as it won't delete itself\nwhen a node is rebooted."]})}),"\n",(0,s.jsx)(n.admonition,{title:"COMMUNITY LEARNING",type:"info",children:(0,s.jsxs)(n.p,{children:["While the settings in this document are required, their implementation here are\nlargely informational. The more advanced you are at configuring nix-based\nsystems, the more you may want to customise what you are doing. If you believe\nyour optimisations will be beneficial to someone else, please do feel free to\nshare in Discord or in GitHub ",(0,s.jsx)(n.a,{href:"https://github.com/orcfax/ITN-Phase-1/discussions",children:"discussions"}),"."]})}),"\n",(0,s.jsx)(n.h3,{id:"cron",children:"Cron"}),"\n",(0,s.jsx)(n.p,{children:"Cron is used to schedule collection. The collector uses a number of environment\nvariables, and can be configured inside the cron runner. Cron is configured to\nask for data every minute. The config look as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cron",children:"ORCFAX_VALIDATOR=\nNODE_IDENTITY_LOC=\nNODE_SIGNING_KEY=\nGOFER=\nCNT_DB_NAME=/var/tmp/notused.db\nOGMIOS_URL=ws://example.com/ogmios\n\n* * * * * /path/to/collector-node --feeds /path/to/cer-feeds.json 2>&1 | logger -t orcfax_collector\n"})}),"\n",(0,s.jsxs)(n.p,{children:["An example that assumes an user called ",(0,s.jsx)(n.code,{children:"orcfax"})," with a virtual environment\nconfigured to run the Python-based code:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cron",children:"ORCFAX_VALIDATOR=wss://itn.0.orcfax.io/ws/node\nNODE_IDENTITY_LOC=/tmp/.node-identity.json\nNODE_SIGNING_KEY=/home/orcfax/signing-key/payment.skey\nGOFER=/home/orcfax/gofer/gofer\nCNT_DB_NAME=/var/tmp/notused.db\nOGMIOS_URL=ws://example.com/ogmios\n\n* * * * * /home/orcfax/collector/venv/bin/collector-node --feeds /home/orcfax/collector/cer-feeds.json 2>&1 | logger -t orcfax_collector\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var o=i(6540);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);