"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6665],{430:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"developer-manual/archived docs","title":"Archived docs","description":"This section contains instructions, and commentary relating to Orcfax solution","source":"@site/docs/developer-manual/archived-docs.md","sourceDirName":"developer-manual","slug":"/archived-docs","permalink":"/archived-docs","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"archived docs","sidebar_position":4,"slug":"/archived-docs"},"sidebar":"tutorialSidebar","previous":{"title":"Protocol deployments","permalink":"/deployments"},"next":{"title":"Terms of service","permalink":"/terms-of-service"}}');var i=t(4848),r=t(8453);const s={id:"archived docs",sidebar_position:4,slug:"/archived-docs"},o="Archived docs",d={},c=[{value:"v0",id:"v0",level:2},{value:"Policy details",id:"policy-details",level:3},{value:"In use",id:"in-use",level:3},{value:"v0 datum structure",id:"v0-datum-structure",level:3},{value:"v0 JSON-LD schema",id:"v0-json-ld-schema",level:4},{value:"Reading v0 datum on-chain",id:"reading-v0-datum-on-chain",level:3},{value:"Where can I find the price data in the datum?",id:"where-can-i-find-the-price-data-in-the-datum",level:4},{value:"Reading v0 datum off-chain",id:"reading-v0-datum-off-chain",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"archived-docs",children:"Archived docs"})}),"\n",(0,i.jsxs)(n.p,{children:["This section contains instructions, and commentary relating to Orcfax solution\nversions and/or components ",(0,i.jsx)(n.strong,{children:"which are no longer in operation"}),". This\ninformation has been left as an educational resource and as a testament to the\ndevelopment journey of the Orcfax oracle solution."]}),"\n",(0,i.jsx)(n.h2,{id:"v0",children:"v0"}),"\n",(0,i.jsxs)(n.p,{children:["The v0 solution offered by Orcfax on Cardano mainnet was released in 2023 and\nutilized the Cardano Open Oracle Protocol (",(0,i.jsx)(n.a,{href:"https://github.com/mlabs-haskell/cardano-open-oracle-protocol/",children:"COOP"}),") to format and publish\ninformation on-chain. The protocol constituted a set of technical guidelines\nthat specified a process, and format, for the publication and consumption of\noff-chain data by smart contracts on the Cardano blockchain."]}),"\n",(0,i.jsxs)(n.p,{children:["The Orcfax team developed the Cardano Open Oracle Protocol as a Catalyst funded\nresearch project that aimed to maximize the ",(0,i.jsx)(n.a,{href:"https://docs.cardano.org/learn/eutxo-explainer/",children:"eUTXO"})," model and leveraged\ndesign principles, ",(0,i.jsx)(n.a,{href:"https://docs.cardano.org/about-cardano/evolution/upgrades/vasil/#reference-inputs-cip-31",children:"CIP-31"}),", and ",(0,i.jsx)(n.a,{href:"https://docs.cardano.org/about-cardano/evolution/upgrades/vasil/#inline-datums-cip-32",children:"CIP-32"})," to prioritize a\ncost-sensitive, post-Vasil native method for publishing secure, signed, datums\non-chain for reference input consumption by Cardano dApps."]}),"\n",(0,i.jsxs)(n.p,{children:["The initial version of COOP was developed in collaboration with ",(0,i.jsx)(n.a,{href:"https://mlabs.city/",children:"MLabs"}),"\nconsultancy. The guidelines and specification in COOP are free, open-source, and\ncan be implemented by any other project seeking to develop their own Cardano\noracle feeds."]}),"\n",(0,i.jsx)(n.p,{children:"Shortly after this version was released, IOG discontinued support for both the\nPlutus Application Backend (PAB) and Plutus-Chain-Index. Both were critical\ncomponents in the COOP v0 stack. Aware of the discontinued support, the Orcfax\nteam partnered with technical consultants through MLabs to replace the\ncomponents. Unfortunately, the plutus-chain-index component failed before a\nreplacement could be rolled-out."}),"\n",(0,i.jsx)(n.p,{children:"And so v0 was suspended in May of 2024."}),"\n",(0,i.jsxs)(n.p,{children:["More information pertaining to this failure can be found in both the ",(0,i.jsx)(n.a,{href:"https://medium.com/@orcfax/orcfax-feed-suspension-and-protocol-upgrade-a45709dafb56",children:"public\nannouncement"})," and in the subsequent incident ",(0,i.jsx)(n.a,{href:"https://github.com/orcfax/Incidents/issues/38",children:"report"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Users and developers may find it informative to review the entire v0\n",(0,i.jsx)(n.a,{href:"https://github.com/orcfax/Incidents",children:"Incidents"})," repository as it contains many critical learnings\nfrom the implementation of v0."]}),"\n",(0,i.jsx)(n.h3,{id:"policy-details",children:"Policy details"}),"\n",(0,i.jsxs)(n.p,{children:["Links and information pertaining to policy IDs and smart contract addresses can\nbe found in ",(0,i.jsx)(n.a,{href:"deployments#v0",children:"Protocol Deployments"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"in-use",children:"In use"}),"\n",(0,i.jsx)(n.p,{children:"Minting policy identifiers were critical as Fact Statements were to be verified\nas having come from a known source. These identifiers also provided the ability\nto filter all of the UTXO at a given smart contract address and to filter out\nthose sent by others to the same address."}),"\n",(0,i.jsx)(n.p,{children:"Users were required to use the following information to identify the latest\nFacts published."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Minting policy ID."}),"\n",(0,i.jsxs)(n.li,{children:["Datum format, including:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Most recent (",(0,i.jsx)(n.code,{children:"ValueReference -> PropertyValue[1] -> value)"}),", i.e. the\nlargest POSIX timestamp compared to other Fact Statement datum,"]}),"\n",(0,i.jsx)(n.li,{children:'Feed name, e.g. "ADA-USD".'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: Users on preprod will find a volume of test data that was not ever\nretired as Orcfax previously used this space as a testing sandbox."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In this model, unconsumed reference inputs were those still available for smart\ncontracts to use on-chain. Spending a UTXO with a reference input would render\nit unusable in a smart contract (though the data was still visible in the\nhistorical transaction). This process of consuming reference inputs was referred\nto as ",(0,i.jsx)(n.em,{children:"garbage collection"})," or the ",(0,i.jsx)(n.em,{children:"retiring"})," of Fact Statements."]}),"\n",(0,i.jsx)(n.p,{children:"During v0, Orcfax had a mainnet policy stipulating that two unspent Fact UTXO\nshould remain on-chain at all times in order to provide users with continuous\ndatum coverage."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: maintaining at least two datum on-chain gave smart contracts (and their\ndevelopers) access to the most current datum, and the datum before that, for\ninspection. The POSIX timestamps denoting a valid-from and valid-through\nperiod could be inspected to ensure that they were still within a valid\nwindow."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For more information about the use of reference inputs and the inline datum\nutilized in COOP v0, see the relevant COOP ",(0,i.jsx)(n.a,{href:"https://github.com/mlabs-haskell/cardano-open-oracle-protocol/blob/9e9c9aedba84d32e424b1dd116b4734e1a42f3bc/coop-docs/00-design.md#cardano-features-enabling-oracles",children:"design document"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"v0-datum-structure",children:"v0 datum structure"}),"\n",(0,i.jsxs)(n.p,{children:["All Fact Statements were structured as ",(0,i.jsx)(n.a,{href:"https://json-ld.org/",children:"JSON-LD"})," objects before being\nserialized into the Concise Binary Object Representation (",(0,i.jsx)(n.a,{href:"https://cbor.io/",children:"CBOR"})," used in\nCardano transactions."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Fact Statement",src:t(2039).A+"",width:"3232",height:"1237"})}),"\n",(0,i.jsx)(n.h4,{id:"v0-json-ld-schema",children:"v0 JSON-LD schema"}),"\n",(0,i.jsx)(n.p,{children:"The Orcfax v0 datum was translated to on-chain CBOR from the following JSON\nschema (example given is from Sep 28, 2023):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "@context": "https://schema.org",\n    "type": "PropertyValue",\n    "name": "ADA-USD|USD-ADA",\n    "value": [0.249495, 4.008096354636367],\n    "valueReference": [\n        {\n            "@type": "PropertyValue",\n            "name": "validFrom",\n            "value": 1695939870811\n        },\n        {\n            "@type": "PropertyValue",\n            "name": "validThrough",\n            "value": 1695943470811\n        }\n    ],\n    "identifier": {\n        "propertyID": "Arkly Identifier",\n        "type": "PropertyValue",\n        "value": "urn:orcfax:4ae10640-10b9-4c23-af1d-c4a9dbd8938d"\n    },\n    "_:contentSignature": "40330ff2597c399ddaaab6c1dbaab52173ef82bf7f08d3ca84585ab5e76429a0"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"reading-v0-datum-on-chain",children:"Reading v0 datum on-chain"}),"\n",(0,i.jsxs)(n.p,{children:["Orcfax Fact Statement datum were readable on-chain as Cardano ",(0,i.jsx)(n.a,{href:"https://github.com/perturbing/vasil-tests/blob/main/reference-inputs-cip-31.md",children:"Reference\nInputs"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To have read the ",(0,i.jsx)(n.code,{children:"ADA-USD|USD-ADA"})," mainnet feed, users were encouraged to check\nthe latest transaction issued by the ",(0,i.jsx)(n.a,{href:"https://cexplorer.io/address/addr1w8tcecfy7np3sduzn99ffuv8qx2sa8v977l0xql8ca7lgkgq7lqh2/tx#data",children:"feed smart contract"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"where-can-i-find-the-price-data-in-the-datum",children:"Where can I find the price data in the datum?"}),"\n",(0,i.jsxs)(n.p,{children:["In this example we will use an off-chain datum. We will use this ",(0,i.jsx)(n.a,{href:"https://preprod.cexplorer.io/datum/9ced750ebbb2c9a9eac2e07a91525cadd3bfab23950089faa3e3a55517d1033f",children:"datum"}),",\nwithin which the price data can be found in the following portion:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:'language-"list":',metastring:"[",children:'                            {\n                                "fields": [\n                                    {\n                                        "int": 2540017902\n                                    },\n                                    {\n                                        "int": 1.8446744073709552e+19\n                                    }\n                                ],\n                                "constructor": 3\n                            },\n                            {\n                                "fields": [\n                                    {\n                                        "int": 39369801260558197\n                                    },\n                                    {\n                                        "int": 1.8446744073709552e+19\n                                    }\n                                ],\n                                "constructor": 3\n                            }\n                        ]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The first ",(0,i.jsx)(n.code,{children:'"fields"'})," (we'll call it f1) conveys ADA-USD, the second (f2) conveys\nUSD-ADA. Within each of these, the first int (we'll call it int1) represents a\nprice pair."]}),"\n",(0,i.jsxs)(n.p,{children:["With this in mind, f1, int1 gives the ADA-USD price as an integer (2540017902),\nand the second (f1, int2) gives the number of decimals as ",(0,i.jsx)(n.code,{children:"longint"}),"\n(1.8446744073709552e+19)."]}),"\n",(0,i.jsx)(n.p,{children:"The same is true for f2, int1 which gives the price pair for USD-ADA as an\ninteger; with f2, int2 giving the number of decimals."}),"\n",(0,i.jsx)(n.p,{children:"Using Python, you can find out the price by executing the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-from",metastring:"ctypes import c_longlong",children:"price = p1 * pow(10, c_longlong(p2).value)\n"})}),"\n",(0,i.jsx)(n.p,{children:"With the following results:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Off-chain Datum",src:t(1434).A+"",width:"378",height:"123"})}),"\n",(0,i.jsx)(n.h3,{id:"reading-v0-datum-off-chain",children:"Reading v0 datum off-chain"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://pycardano.readthedocs.io/",children:"PyCardano"})," SDK provided convenient helper functions for\nconverting on-chain CBOR."]}),"\n",(0,i.jsxs)(n.p,{children:["The Orcfax team created an open-source PyCardano ",(0,i.jsx)(n.a,{href:"https://github.com/orcfax/datum-demo/tree/main#readme",children:"demo script"})," to assist\nusers in reading and parsing the on-chain Orcfax datum."]}),"\n",(0,i.jsx)(n.p,{children:"This script converted the Cardano transaction's CBOR serialization to human and\nmachine-readable JSON while simultaneously logging various details about the\nDatum as it went."}),"\n",(0,i.jsx)(n.p,{children:"It's very easy to customize the configuration options of this script to match\nthe requirements of another dApp."}),"\n",(0,i.jsx)(n.p,{children:"This resource was made freely available under an open-source Apache v2.0 license\nso that users could test, integrate, and extend their own solutions by\nintegrating Orcfax Fact Statement feeds."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"demo script output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'2023-09-28T16:24:13Z INFO :: read_datum.py:264:read_datum() :: entering this script...\n2023-09-28T16:24:13Z INFO :: read_datum.py:265:read_datum() :: oracle smart contract: addr_test1wrtcecfy7np3sduzn99ffuv8qx2sa8v977l0xql8ca7lgkgmktuc0\n2023-09-28T16:24:15Z INFO :: read_datum.py:226:get_latest_utxo() :: inspecting \'862\' UTxOs\n2023-09-28T16:24:15Z WARNING :: read_datum.py:254:get_latest_utxo() :: \'7.00\' hours since datum was published (1695943470811)\n2023-09-28T16:24:15Z INFO :: read_datum.py:191:validate_utxo() :: inspecting the utxo for valid auth tokens\n2023-09-28T16:24:15Z INFO :: read_datum.py:217:validate_utxo() :: the utxo is valid, it contains the correct auth token\n2023-09-28T16:24:15Z INFO :: read_datum.py:79:display_utxo() :: (input) transaction id: 078d548b0ed91b95164d0baaf2b486161e06aab84483d99ed01a2180090ab0f3\n2023-09-28T16:24:15Z INFO :: read_datum.py:80:display_utxo() :: (output) transaction addr: addr_test1wrtcecfy7np3sduzn99ffuv8qx2sa8v977l0xql8ca7lgkgmktuc0\n2023-09-28T16:24:15Z INFO :: read_datum.py:81:display_utxo() :: (output) datum cbor:\n\n590207d8799fa74840636f6e746578745268747470733a2f2f736368656d612e6f7267525f3a636f6e74656e745369676e61747572655840343033333066663235393763333939646461616162366331646261616235323137336566383262663766303864336361383435383561623565373634323961304a6964656e746966696572a34a70726f706572747949445041726b6c79204964656e74696669657244747970654d50726f706572747956616c75654576616c7565582f75726e3a6f72636661783a34616531303634302d313062392d346332332d616631642d633461396462643839333864446e616d654f4144412d5553447c5553442d41444144747970654d50726f706572747956616c75654576616c75659fd87c9f1a0003ce971bfffffffffffffffaffd87c9f1b000e3d57a771924e1bfffffffffffffff1ffff4e76616c75655265666572656e63659fa34540747970654d50726f706572747956616c7565446e616d654976616c696446726f6d4576616c75651b0000018adde4c05ba34540747970654d50726f706572747956616c7565446e616d654c76616c69645468726f7567684576616c75651b0000018ade1baedbff5820303443413030303148424559394b4b34343950314345513850483744544a5954d87a9f1b0000018ade1baedbff581c90b121aa6b689200adf7ed115040a96375d2b68e23633d6864c53a91ff\n\n2023-09-28T16:24:15Z INFO :: read_datum.py:84:display_utxo() :: (output) Tx cost: 3.42214 ADA\n2023-09-28T16:24:15Z INFO :: read_datum.py:151:decode_utxo() ::\n\n{\n  "@context": "https://schema.org",\n  "type": "PropertyValue",\n  "name": "ADA-USD|USD-ADA",\n  "value": [\n    0.249495,\n    4.008096354636367\n  ],\n  "valueReference": [\n    {\n      "@type": "PropertyValue",\n      "name": "validFrom",\n      "value": 1695939870811\n    },\n    {\n      "@type": "PropertyValue",\n      "name": "validThrough",\n      "value": 1695943470811\n    }\n  ],\n  "identifier": {\n    "propertyID": "Arkly Identifier",\n    "type": "PropertyValue",\n    "value": "urn:orcfax:4ae10640-10b9-4c23-af1d-c4a9dbd8938d"\n  },\n  "_:contentSignature": "40330ff2597c399ddaaab6c1dbaab52173ef82bf7f08d3ca84585ab5e76429a0"\n}\n\n2023-09-28T16:24:15Z INFO :: read_datum.py:152:decode_utxo() :: oracle datum identifier (internal): b\'04CA0001HBEY9KK449P1CEQ8PH7DTJYT\'\n2023-09-28T16:24:15Z INFO :: read_datum.py:157:decode_utxo() :: oracle datum timestamp: 2023-09-28T23:24:30Z (1695943470811)\n2023-09-28T16:24:15Z INFO :: read_datum.py:170:pretty_log_value() :: ADA-USD: 0.249495\n2023-09-28T16:24:15Z INFO :: read_datum.py:170:pretty_log_value() :: USD-ADA: 4.008096354636367\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},2039:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/2023-09-30--Orcfax--fact-statement-0ff642e16e956a03a7829c3106892607.jpg"},1434:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/2023-10-03--off-chain-datum-walkthrough-9ff0fd4273ec97d9311e19019888f716.png"},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(6540);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);